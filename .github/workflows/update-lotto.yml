# GitHub Actions Workflow - à¸­à¸±à¸žà¹€à¸”à¸—à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸«à¸§à¸¢à¹„à¸—à¸¢à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´
# à¸£à¸±à¸™à¸—à¸¸à¸à¸§à¸±à¸™à¸—à¸µà¹ˆ 1 à¹à¸¥à¸° 16 à¸‚à¸­à¸‡à¹€à¸”à¸·à¸­à¸™ à¹€à¸§à¸¥à¸² 14:30 à¸™. (à¸«à¸¥à¸±à¸‡à¸«à¸§à¸¢à¸­à¸­à¸)

name: Update Lotto Data

on:
  # à¸£à¸±à¸™à¸•à¸²à¸¡à¹€à¸§à¸¥à¸²à¸—à¸µà¹ˆà¸à¸³à¸«à¸™à¸” (cron schedule)
  schedule:
    # à¸£à¸±à¸™à¹€à¸§à¸¥à¸² 07:30 UTC = 14:30 à¸™. à¸•à¸²à¸¡à¹€à¸§à¸¥à¸²à¹„à¸—à¸¢ (GMT+7)
    # à¸§à¸±à¸™à¸—à¸µà¹ˆ 1 à¸‚à¸­à¸‡à¸—à¸¸à¸à¹€à¸”à¸·à¸­à¸™
    - cron: '30 7 1 * *'
    # à¸§à¸±à¸™à¸—à¸µà¹ˆ 16 à¸‚à¸­à¸‡à¸—à¸¸à¸à¹€à¸”à¸·à¸­à¸™
    - cron: '30 7 16 * *'
  
  # à¸ªà¸²à¸¡à¸²à¸£à¸–à¸£à¸±à¸™à¸”à¹‰à¸§à¸¢à¸¡à¸·à¸­à¹„à¸”à¹‰à¸ˆà¸²à¸à¸«à¸™à¹‰à¸² Actions
  workflow_dispatch:

jobs:
  update-lotto:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write
    
    steps:
      - name: ðŸ“¥ Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1
      
      - name: ðŸŸ¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: ðŸŽ° Run lotto update script
        run: node fetch_lotto_update.js
      
      - name: ðŸ“ Check for changes
        id: check_changes
        run: |
          if git diff --quiet example2.json; then
            echo "has_changes=false" >> $GITHUB_OUTPUT
            echo "ðŸ“­ No new data found"
          else
            echo "has_changes=true" >> $GITHUB_OUTPUT
            echo "ðŸ“¬ New data found!"
          fi
      
      - name: ðŸ’¾ Commit and push changes
        if: steps.check_changes.outputs.has_changes == 'true'
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add example2.json
          git commit -m "ðŸŽ° à¸­à¸±à¸žà¹€à¸”à¸—à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸«à¸§à¸¢à¸‡à¸§à¸”à¹ƒà¸«à¸¡à¹ˆ - $(date +'%d/%m/%Y')"
          git push
